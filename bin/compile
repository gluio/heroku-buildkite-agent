#!/bin/sh
SCRIPT_PATH="`dirname \"$0\"`"
BUILD_DIR=$1
CACHE_DIR=$2
cd $GIT_DIR
echo "=====> getting commit hash"
COMMIT_HASH=$(git rev-parse HEAD)
echo "=====> Saving $COMMIT_HASH to env"
mkdir -p $BUILD_DIR/.profile.d
echo "export COMMIT_HASH=\"\$COMMIT_HASH\"" > $BUILD_DIR/.profile.d/commit_hash.sh

cd $SCRIPT_PATH/..
cat Procfile >> $1/Procfile && cp bin/buildkite-agent $1/bin/ && mkdir -p $1/.buildkite && cp etc/bootstrap.sh $1/.buildkite/bootstrap.sh && mkdir -p $1/.buildkite/hooks && cp hooks/checkout $1/.buildkite/hooks
